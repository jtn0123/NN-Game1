<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Network AI - Training Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>üß† Neural Network AI</h1>
                <span class="subtitle">Breakout Training Dashboard</span>
            </div>
            <div class="header-right">
                <div class="status-indicator" id="status-indicator">
                    <span class="status-dot"></span>
                    <span class="status-text">Connecting...</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Column: Charts + Console -->
            <div class="charts-column">
                <!-- Score Chart -->
                <div class="chart-card">
                    <div class="card-header">
                        <h2>üìä Training Progress</h2>
                        <div class="chart-legend">
                            <span class="legend-item score">‚óè Score</span>
                            <span class="legend-item avg">‚óè Average</span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="scoreChart"></canvas>
                    </div>
                </div>

                <!-- Dual Chart Row -->
                <div class="chart-row">
                    <!-- Loss Chart -->
                    <div class="chart-card half">
                        <div class="card-header">
                            <h2>üìâ Loss</h2>
                        </div>
                        <div class="chart-container small">
                            <canvas id="lossChart"></canvas>
                        </div>
                    </div>

                    <!-- Q-Value Chart -->
                    <div class="chart-card half">
                        <div class="card-header">
                            <h2>üìà Avg Q-Value</h2>
                        </div>
                        <div class="chart-container small">
                            <canvas id="qvalueChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Console Log -->
                <div class="console-card">
                    <div class="card-header">
                        <h2>üìã Console Log</h2>
                        <div class="console-controls">
                            <div class="filter-buttons">
                                <button class="filter-btn active" data-filter="all" onclick="setLogFilter('all')">All</button>
                                <button class="filter-btn" data-filter="info" onclick="setLogFilter('info')">Info</button>
                                <button class="filter-btn" data-filter="metric" onclick="setLogFilter('metric')">Metrics</button>
                                <button class="filter-btn" data-filter="action" onclick="setLogFilter('action')">Actions</button>
                                <button class="filter-btn" data-filter="warning" onclick="setLogFilter('warning')">Warnings</button>
                            </div>
                            <button class="clear-btn" onclick="clearLogs()">üóëÔ∏è Clear</button>
                        </div>
                    </div>
                    <div class="console-container" id="console-container">
                        <div class="console-output" id="console-output">
                            <div class="console-line info">
                                <span class="log-time">--:--:--</span>
                                <span class="log-level">INFO</span>
                                <span class="log-message">Waiting for connection...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Stats & Controls -->
            <div class="stats-column">
                <!-- Metrics Grid -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Episode</div>
                        <div class="metric-value" id="metric-episode">0</div>
                    </div>
                    <div class="metric-card highlight">
                        <div class="metric-label">Current Score</div>
                        <div class="metric-value" id="metric-score">0</div>
                    </div>
                    <div class="metric-card best">
                        <div class="metric-label">Best Score</div>
                        <div class="metric-value" id="metric-best">0</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Win Rate</div>
                        <div class="metric-value" id="metric-winrate">0%</div>
                    </div>
                </div>

                <!-- Epsilon Gauge -->
                <div class="gauge-card">
                    <div class="card-header">
                        <h3>üé≤ Exploration (Œµ)</h3>
                        <span class="gauge-value" id="epsilon-value">1.000</span>
                    </div>
                    <div class="gauge-container">
                        <div class="gauge-bar">
                            <div class="gauge-fill" id="epsilon-fill"></div>
                        </div>
                        <div class="gauge-labels">
                            <span>Exploit</span>
                            <span>Explore</span>
                        </div>
                    </div>
                </div>

                <!-- Extended Training Info -->
                <div class="info-card">
                    <div class="card-header">
                        <h3>‚öôÔ∏è Training Stats</h3>
                    </div>
                    <div class="info-grid">
                        <div class="info-row">
                            <span class="info-label">Loss</span>
                            <span class="info-value" id="info-loss">0.0000</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Steps</span>
                            <span class="info-value" id="info-steps">0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Ep/s</span>
                            <span class="info-value" id="info-eps">0.0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Memory</span>
                            <span class="info-value" id="info-memory">0 / 100k</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Avg Q-Value</span>
                            <span class="info-value" id="info-qvalue">0.00</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Target Updates</span>
                            <span class="info-value" id="info-target">0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Explore/Exploit</span>
                            <span class="info-value" id="info-actions">0 / 0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Status</span>
                            <span class="info-value status-badge" id="info-status">Training</span>
                        </div>
                    </div>
                </div>

                <!-- Game Preview -->
                <div class="preview-card">
                    <div class="card-header">
                        <h3>üéÆ Game Preview</h3>
                        <button class="refresh-btn" onclick="refreshScreenshot()">‚Üª</button>
                    </div>
                    <div class="preview-container">
                        <img id="game-preview" src="" alt="Game Preview">
                        <div class="preview-placeholder" id="preview-placeholder">
                            No preview available
                        </div>
                    </div>
                </div>

                <!-- Main Controls -->
                <div class="controls-card">
                    <div class="card-header">
                        <h3>üéõÔ∏è Controls</h3>
                    </div>
                    <div class="controls-grid">
                        <button class="control-btn pause" id="pause-btn" onclick="togglePause()">
                            ‚è∏Ô∏è Pause
                        </button>
                        <button class="control-btn save" onclick="saveModel()">
                            üíæ Save
                        </button>
                        <button class="control-btn reset" onclick="resetEpisode()">
                            üîÑ Reset
                        </button>
                        <button class="control-btn load" onclick="showLoadModal()">
                            üìÇ Load
                        </button>
                    </div>
                    
                    <!-- Speed Control -->
                    <div class="speed-control">
                        <label class="speed-label">
                            <span>‚è© Speed</span>
                            <span id="speed-value">1.0x</span>
                        </label>
                        <input type="range" 
                               id="speed-slider" 
                               min="0.25" 
                               max="4" 
                               step="0.25" 
                               value="1"
                               oninput="updateSpeed(this.value)">
                        <div class="speed-marks">
                            <span>0.25x</span>
                            <span>1x</span>
                            <span>2x</span>
                            <span>4x</span>
                        </div>
                    </div>
                </div>

                <!-- Settings Panel -->
                <div class="settings-card collapsed" id="settings-card">
                    <div class="card-header clickable" onclick="toggleSettings()">
                        <h3>‚öôÔ∏è Settings</h3>
                        <span class="collapse-icon" id="settings-icon">‚ñº</span>
                    </div>
                    <div class="settings-content" id="settings-content">
                        <div class="setting-row">
                            <label for="setting-lr">Learning Rate</label>
                            <input type="number" id="setting-lr" value="0.0001" step="0.00001" min="0">
                        </div>
                        <div class="setting-row">
                            <label for="setting-epsilon">Epsilon</label>
                            <input type="number" id="setting-epsilon" value="1.0" step="0.01" min="0" max="1">
                        </div>
                        <div class="setting-row">
                            <label for="setting-decay">Epsilon Decay</label>
                            <input type="number" id="setting-decay" value="0.995" step="0.001" min="0" max="1">
                        </div>
                        <div class="setting-row">
                            <label for="setting-gamma">Gamma</label>
                            <input type="number" id="setting-gamma" value="0.99" step="0.01" min="0" max="1">
                        </div>
                        <div class="setting-row">
                            <label for="setting-batch">Batch Size</label>
                            <input type="number" id="setting-batch" value="64" step="8" min="8">
                        </div>
                        <button class="apply-btn" onclick="applySettings()">Apply Changes</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <span>Neural Network Game AI</span>
            <span class="separator">|</span>
            <span>Double DQN + Prioritized Replay</span>
            <span class="separator">|</span>
            <span id="footer-time"></span>
        </footer>
    </div>

    <!-- Load Model Modal -->
    <div class="modal" id="load-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÇ Load Model</h3>
                <button class="close-btn" onclick="hideLoadModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="model-list" id="model-list">
                    <div class="loading">Loading models...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
